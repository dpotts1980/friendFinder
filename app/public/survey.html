<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<title>Survey</title>

<!-- Latest compiled and minified CSS & JS -->
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous">
	<script src="https://code.jquery.com/jquery.js"></script>
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js" integrity="sha384-0mSbJDEHialfmuBBQP6A4Qrprq5OVfW37PRR3j5ELqxss1yVqOtnepnHVP9aJ7xS" crossorigin="anonymous"></script>
	
</head>
<body>
	<div class="container">
	
		<h1>Complete the survey to find your dream match!</h1>
		<hr>
		<form role="form" id="survey">
			<h2>About you</h2>
			<div class="form-group">
				<label for="usr">Name: (Required)</label>
				<input type="text" class="form-control" id="name">
			</div>
			<div class="form-group">
				<label for="pic">URL for Photo: (Required)</label>
				<input type="text" class="form-control" id="picture">
				
			</div>
			<hr>
			<h2>Rate how strongly you agree or disagree with the following statements:</h2>

			<div class="row col-lg-10">
				<h3>Question 1</h3>
				<h4>I love going to large parties because they are intimate. You have no privacy at small parties.</h4>
				<div class="form-group col-xs-3">
					<select class="form-control" id="question1">
						<option>1 (Strongly Disagree)</option>
						<option>2</option>
						<option>3</option>
						<option>4</option>
						<option>5 (Strongly Agree)</option>
					</select>
				</div>
			</div>

			<div class="row col-lg-10">
				<h3>Question 2</h3>
				<h4>I'm a carnivore, do not dare serve me Tofu.</h4>
				<div class="form-group col-xs-3">
					<select class="form-control" id="question2">
						<option>1 (Strongly Disagree)</option>
						<option>2</option>
						<option>3</option>
						<option>4</option>
						<option>5 (Strongly Agree)</option>
					</select>
				</div>
			</div>

			<div class="row col-lg-10">
				<h3>Question 3</h3>
				<h4>Everyone says this is the golden age of television, but the 1990's really was.</h4>
				<div class="form-group col-xs-3">
					<select class="form-control" id="question3">
						<option>1 (Strongly Disagree)</option>
						<option>2</option>
						<option>3</option>
						<option>4</option>
						<option>5 (Strongly Agree)</option>
					</select>
				</div>
			</div>

			<div class="row col-lg-10">
				<h3>Question 4</h3>
				<h4>Putting cream and sugar in one's coffee is a sign of weakness!</h4>
				<div class="form-group col-xs-3">
					<select class="form-control" id="question4">
						<option>1 (Strongly Disagree)</option>
						<option>2</option>
						<option>3</option>
						<option>4</option>
						<option>5 (Strongly Agree)</option>
					</select>
				</div>
			</div>

			<div class="row col-lg-10">
				<h3>Question 5</h3>
				<h4>I'm not one for 5 star resorts. Just give me a backpack, a pocket knife, and a change of socks.</h4>
				<div class="form-group col-xs-3">
					<select class="form-control" id="question5">
						<option>1 (Strongly Disagree)</option>
						<option>2</option>
						<option>3</option>
						<option>4</option>
						<option>5 (Strongly Agree)</option>
					</select>
				</div>
			</div>

			<div class="row col-lg-12">
				<h3>Question 6</h3>
				<h4>In the words of Dwight Schrute, I would describle myself as "Three words. Hard-working. Alpha male. Jackhammer. Merciless. Insatiable.‚Äù </h4>
				<div class="form-group col-xs-3">
					<select class="form-control" id="question6">
						<option>1 (Strongly Disagree)</option>
						<option>2</option>
						<option>3</option>
						<option>4</option>
						<option>5 (Strongly Agree)</option>
					</select>
				</div>
			</div>

			<div class="row col-lg-10">
				<h3>Question 7</h3>
				<h4>Beatles or Stones? Definitely the Beatles!</h4>
				<div class="form-group col-xs-3">
					<select class="form-control" id="question7">
						<option>1 (Strongly Disagree)</option>
						<option>2</option>
						<option>3</option>
						<option>4</option>
						<option>5 (Strongly Agree)</option>
					</select>
				</div>
			</div>

			<div class="row col-lg-10">
				<h3>Question 8</h3>
				<h4>I like a weekend in the country, but city life is the way to live.</h4>
				<div class="form-group col-xs-3">
					<select class="form-control" id="question8">
						<option>1 (Strongly Disagree)</option>
						<option>2</option>
						<option>3</option>
						<option>4</option>
						<option>5 (Strongly Agree)</option>
					</select>
				</div>
			</div>

			<div class="row col-lg-10">
				<h3>Question 9</h3>
				<h4> Suits are for weddings and funerals, I'm a jeans and tee shirt type of guy.</h4>
				<div class="form-group col-xs-3">
					<select class="form-control" id="question9">
						<option>1 (Strongly Disagree)</option>
						<option>2</option>
						<option>3</option>
						<option>4</option>
						<option>5 (Strongly Agree)</option>
					</select>
				</div>
			</div>

			<div class="row col-lg-10">
				<h3>Question 10</h3>
				<h4>I'm not one for the air or the water... it's much nicer on solid ground.</h4>
				<div class="form-group col-xs-3">
					<select class="form-control" id="question10">
						<option>1 (Strongly Disagree)</option>
						<option>2</option>
						<option>3</option>
						<option>4</option>
						<option>5 (Strongly Agree)</option>
					</select>
				</div>
			</div>
			
			<button type="button" class="btn btn-success btn-block" id="submit">Submit</button>
	
		</form>

				<!-- Modal -->
				<div class="modal fade" id="match-modal" role="dialog">
					<div class="modal-dialog">
					
					  <!-- Modal content-->
					  <div class="modal-content">
						<div class="modal-header">
						  <button type="button" class="close" data-dismiss="modal">&times;</button>
						  <h4 class="modal-title"></h4>
						</div>
						<div class="modal-body">
						</div>
						<div class="modal-footer">
						  <button type="button" class="btn btn-primary" data-dismiss="modal">Close</button>
						</div>
					  </div>
					  
					</div>
				  </div>
				  <div class="footer">
					  <br>
					  <br>
				  </div>
					</div>
		<!-- adding jquery -->
		<script type="text/javascript">
		 
	$('#submit').on("click", function(event){
		event.preventDefault();

		var correctEntry;
		if($("#name").val().trim() === ''){
			alert('Please enter your name');
		}
		else if($("#picture").val().trim() === ''){
			alert('Field must have a valid link to your photo');
			console.log("is working");
		}

		else{
			//creating empty array which we will push entries into
			var entryArray = [];
			//need to loop through the entries
			for(i = 1; i < 11; i++){
				entryArray.push(parseInt($('#question' + i).val().substring(0,1)));
			}

			//creating an object to hold new entries
			var newEntry =
			{
				name: $("#name").val().trim(),
				photo: $("#picture").val().trim(),
				scores: entryArray
			}
			//records the current location (should work after deployment)
			var correctURL = window.location.origin;
			//add the newly entered information to the friend array
			$.post(correctURL + "/api/friends", newEntry,
		    function(data){});
			//looking into our array of potential friends to see best match//
			$.ajax({url: correctURL +  "/api/friends", method: "GET"}).done(function(res){
					var topMatch;
					var currentMatch = 100;
					var diffArr = [];
			///looping through the friends to see matches//
			for (idx = 0; idx < res.length - 1; idx++) {
				//comparing the values from the survey and pushing the absolute value of differences to diffArr
				for(j = 0; j < 10; j++) {
					var immediateDiff = newEntry.scores[j] - res[idx].scores[j];
					diffArr.push(Math.abs(immediateDiff));
				}
				//adding up all the values in the array and making a single value that represents the difference between potential match and current inputs//
				var diff = diffArr.reduce(add, 0);
				//if the difference is less then previous entries, push the current entry to the best match/
				if(diff < currentMatch) {
					topMatch = res[idx];
					currentMatch = diff;
					diffArr = [];

				}
				else{
					diffArr = [];
				}
			}
					//setting up modal display//
					var nameOfFriend = "<h4>" + topMatch.name + "<h4>";
					var pictureOfFriend = '<img width="300px" src=' + topMatch.photo + '>';
					//showing the modal//
					$('#match-modal').modal('show');
					$('#match-modal h4').html(nameOfFriend);
					$('.modal-body').html(pictureOfFriend);
					//clear the entries
				    $('#survey')[0].reset();

			});//end of ajax

		}//end of else
		return false;
	});
function add(a, b){
	return a+b;
};
</script>
</body>